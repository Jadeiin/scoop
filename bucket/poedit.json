{
    "version": "3.7",
    "description": "Gettext translations editor.",
    "homepage": "https://poedit.net",
    "license": "MIT",
    "url": "https://download.poedit.net/Poedit-3.7-setup.exe",
    "hash": "83d6ca0a5a0706309bdc1ed214e735fd4b44a8ac5b82817c4bc914fbd94f5904",
    "innosetup": true,
    "bin": "Poedit.exe",
    "shortcuts": [
        [
            "Poedit.exe",
            "Poedit"
        ]
    ],
    "post_install": [
        "Get-ChildItem \"$dir\\Resources\" 'Poedit,1.ico' | Rename-Item -NewName 'Poedit.ico'",
        "Write-Host 'Registering file associations and protocol handler...'",
        "$fileTypes = @('.po', '.mo', '.gmo', '.pot', '.xlf', '.xliff', '.json', '.arb')",
        "$fileAssociations = @{",
        "    '.po' = @{",
        "        'progId' = 'Poedit.PO';",
        "        'description' = 'PO Translation';",
        "        'resourceId' = '-222'",
        "    };",
        "    '.mo' = @{",
        "        'progId' = 'Poedit.MO';",
        "        'description' = 'Compiled Translation';",
        "        'resourceId' = '-223'",
        "    };",
        "    '.gmo' = @{",
        "        'progId' = 'Poedit.MO';",
        "        'description' = 'Compiled Translation';",
        "        'resourceId' = '-223'",
        "    };",
        "    '.pot' = @{",
        "        'progId' = 'Poedit.POT';",
        "        'description' = 'Translation Template';",
        "        'resourceId' = '-224'",
        "    };",
        "    '.xlf' = @{",
        "        'progId' = 'Poedit.XLIFF';",
        "        'description' = 'XLIFF Translation';",
        "        'resourceId' = '-225'",
        "    };",
        "    '.xliff' = @{",
        "        'progId' = 'Poedit.XLIFF';",
        "        'description' = 'XLIFF Translation';",
        "        'resourceId' = '-225'",
        "    };",
        "    '.json' = @{",
        "        'progId' = 'Poedit.JSON';",
        "        'description' = 'JSON Document';",
        "        'resourceId' = '-226'",
        "    };",
        "    '.arb' = @{",
        "        'progId' = 'Poedit.ARB';",
        "        'description' = 'Flutter Translation';",
        "        'resourceId' = '-227'",
        "    }",
        "}",
        "foreach ($ext in $fileTypes) {",
        "    $assoc = $fileAssociations[$ext]",
        "    New-Item \"HKCU:\\SOFTWARE\\Classes\\$ext\\OpenWithProgids\" -Force | Out-Null",
        "    New-ItemProperty \"HKCU:\\SOFTWARE\\Classes\\$ext\\OpenWithProgids\" -Name $assoc.progId -Value '' -Force | Out-Null",
        "    New-Item \"HKCU:\\SOFTWARE\\Classes\\$($assoc.progId)\" -Value $assoc.description -Force | Out-Null",
        "    New-ItemProperty \"HKCU:\\SOFTWARE\\Classes\\$($assoc.progId)\" -Name 'FriendlyTypeName' -Value \"@$dir\\Poedit.exe,$($assoc.resourceId)\" -Force | Out-Null",
        "    New-Item \"HKCU:\\SOFTWARE\\Classes\\$($assoc.progId)\\shell\\open\\command\" -Value \"\"\"$dir\\Poedit.exe\"\" \"\"%1\"\"\" -Force | Out-Null",
        "}",
        "# Register poedit:// protocol handler",
        "New-Item 'HKCU:\\SOFTWARE\\Classes\\poedit' -Value 'URL:Poedit Custom Protocol' -Force | Out-Null",
        "New-ItemProperty 'HKCU:\\SOFTWARE\\Classes\\poedit' -Name 'URL Protocol' -Value '' -Force | Out-Null",
        "New-Item 'HKCU:\\SOFTWARE\\Classes\\poedit\\DefaultIcon' -Value \"$dir\\Poedit.exe,0\" -Force | Out-Null",
        "New-Item 'HKCU:\\SOFTWARE\\Classes\\poedit\\shell\\open\\command' -Value \"\"\"$dir\\Poedit.exe\"\" --handle-poedit-uri \"\"%1\"\"\" -Force | Out-Null",
        "Write-Host 'Done!'"
    ],
    "pre_uninstall": [
        "Write-Host 'Removing file associations and protocol handler...'",
        "$fileTypes = @('.po', '.mo', '.gmo', '.pot', '.xlf', '.xliff', '.json', '.arb')",
        "$fileAssociations = @('Poedit.PO', 'Poedit.MO', 'Poedit.POT', 'Poedit.XLIFF', 'Poedit.JSON', 'Poedit.ARB')",
        "foreach ($ext in $fileTypes) {",
        "    Remove-Item \"HKCU:\\SOFTWARE\\Classes\\$ext\\OpenWithProgids\" -Force -ErrorAction SilentlyContinue",
        "}",
        "foreach ($class in $fileAssociations) {",
        "    Remove-Item \"HKCU:\\SOFTWARE\\Classes\\$class\" -Force -Recurse -ErrorAction SilentlyContinue",
        "}",
        "Remove-Item 'HKCU:\\SOFTWARE\\Classes\\poedit' -Force -Recurse -ErrorAction SilentlyContinue",
        "Write-Host 'Done!'"
    ],
    "checkver": {
        "url": "https://poedit.net/download",
        "regex": "Poedit-([\\d.]+)-setup"
    },
    "autoupdate": {
        "url": "https://download.poedit.net/Poedit-$version-setup.exe"
    }
}
